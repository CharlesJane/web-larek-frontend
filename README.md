# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

### Базовые типы

Вынесенный тип ID карточки

```
type ID = string;
```

Карточка товара

```
interface IProduct {
    id: ID;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number;
}
```

Список карточек товаров

```
export interface IProductsList {
    _items: IProduct[];
}
```

Данные о заказе - тип оплаты, контакты, адрес

```
export interface IUserOrder {
    payment: string;
    email: string;
    phone: string;
    address: string;
}
```

Данные корзины

```
export type TProductBasket = Pick<IProduct, 'id' | 'title' | 'price'>;
```

Данные, уходящие на сервер для оформления заказа

```
export interface IOrderData { // данные, уходящие к серверу для оформления заказа
    payment: string;
    email: string;
    phone: string;
    address: string;
    total: number;
    items: string[];
}
```

### Презентер

Интерфейс для данных карточки, устанавливает превью и получает id переданной карточки


##  Архитектура приложения 

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице;
- слой данных, отвечает за хранение и изменение данных;
- презентер, отвечает за связь представления и данных;

### Базовый код 

#### Класс Api 
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- 'get' - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- 'post' - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт, переданный как параметр при вызове метода. По умолчанию выполняется 'POST' запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом, описаны интерфейсом 'IEvents':
- 'on' - подписка на событие;
- 'emit' - инициализация события;
- 'trigger' - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Класс Components
Базовый класс, функционал которого расширяют все основные и абстрактные классы. Позволяет сократить манипуляции с кодом за счет выделения общих методов и переиспользования в компактном виде.

### Классы данных
 
#### Класс ProductsModel

Класс отвечает за хранение карточек товаров.\
Конструктор класса принимает экземпляр брокера событий.\
В полях класса хранятся следующие данные: 
- _items: IProduct[] - массив карточек продуктов
- _preview: string | null - id карточки, выбранной для просмотра в модальном окне
- events: IEvents - экземпляр класса 'EventEmitter' для инициализации событий при изменении данных

Так же класс предоставляет метод возвращения карточки товара из массива карточек по id: 
- getProduct(productId:string): IProduct
Так же класс реализует функционал получения и передачи массива карточек, получения 1 карточки по ее ID, а так же метод для установки превью.

#### Класс BasketModel

Класс отвечает за получение и логику обработки данных заказа.\
Конструктор класса принимает экземпляр брокера событий.\
В полях класса хранятся следующие данные:
- items: TProductBasket[] - массив переданных в корзину карточек товаров
- events: IEvents - экземпляр класса 'EventEmitter' для инициализации событий при изменении данных

Класс предоставляет набор методов для обработки получаемых данных:
- addProduct(product: TProductBasket),
- deleteProduct(productId: string): void - методы добавления и удаления карточек из корзины
- clear(): void - метод очистки корзины
- getCount(): number - метод получения количества товаров в корзине
- getTotal(): number - метод получения общей суммы корзины
- hasProduct(productId: string): boolean - метод проверки на то, что карточка с преданным ID уже есть в корзине
- getProductIds(): string[] - получение ID всех карточек из корзины

#### Класс UserOrderModel

Класс отвечает за получение и логику обработки данных пользователя.\
Конструктор класса принимает экземпляр брокера событий.\
В полях класса хранятся следующие данные:
- events: IEvents - экземпляр класса 'EventEmitter' для инициализации событий при изменении данных
- order: IUserOrder = {
        email: '',
        phone: '',
        payment: null,
        address: ''
    }; - данные о заказе в виде массива
- formErrors: FormErrors - ошибки, получаемые при валидации данных

Класс предоставляет набор методов для обработки получаемых данных:
- checkOrderInfoValidation(data: Record<keyof (TOrderContacts | TOrderInfo), string>): boolean -  валидирует отправляемые на сервер данные из полей заказа
- emitChanges(event: string, payload?: object) - общий метод для установки брокера событий
- get orderData(): IUserOrder - метод, позваляет получить данные  о заказе
- setOrderField(field: keyof IUserOrder, value: string) валидирует данные из полей заказа
- validateOrder() - валидирует отправляемые на сервер данные из полей заказа
- initOrder() - метод инициализирует данные заказа

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Page

Отвечает за отображение на главной странице. Конструктор принимает экземпляр 'EventEmitter' для инициации событий и контейнер.\

Поля класса содержат элементы разметки счетчика, куда передаются данные о количестве товаров в корзине, а так же контейнер для вывода карточек, обертку для блокировки прокрутки при открытом модальном окне, кнопку для перехода в корзину. 

Методы класса включают себя сеттеры для отображения счетчика и вывода товаров в каталог, а так же сеттер блокировки обертки.

#### Класс ProductCard 

Отвечает за общее отображение карточки, задавая в карточке данные названия, ID, цены, опционально категории, изображения и описания. Класс так же содержит кнопку.\
В конструктор класса передается контейнер.\
Поля класса содержат элементы разметки полей карточек.

Класс предоставляет набор сеттеров и геттеров для полей.

#### Класс PreviewProductCard 
Отвечает за рендер превью карточки. Получает контейнер и брокер событий. Предоставляет метод для получения контейнера.

#### Класс BasketProductCard
Отвечает за рендер карточки в корзине. Содержит в себе элементы разметки индекса номера карточки в списке. Получает в конструктор контейнер и брокер событий. Предоставляет метод для получения и сохранения индекса карточки. 

#### Класс GalleryProductCard 
Отвечает за рендер карточки в каталоге. Получает в конструктор контейнер и брокер событий. Отслеживает событие по кнопке-контейнеру. 

#### Класс ModalContainer
Класс реализует рендер html-элемента модального окна, являющегося контейнером для отображаемых элементов интерфейса. Предоставляет методы 'open' и 'close' для управления отображением модального окна, метод 'render' для отрисовки модального окна при открытии. \
Устанавливает слушатели для закрытия окна по оверлэю и кнопке закрытия.
- constructor принимает контейнер и экземпляр класса 'EventEmitter' для инициалции событий, инициализирует кнопку закрытия и  передаваемый в разметку темплейт для отображения.

#### Класс Basket
Класс реализует отображение корзины с выводом списка добавленных в нее карточек товаров. При нажатии на кнопку инициирует событие, передавая в него объект корзины (данные о списке переданных карточек и общей сумме). Получает экземпляр eventEmitter.

Поля класса:
- basketList: HTMLOListElement - элемент разметки, принимающий в поля списка элементы разметки карточек
- totalPrice: HTMLSpanElement - спан с отображением общей стоимости товаров
- basketButton: HTMLButtonElement - элемент кнопки для оформления заказа

Методы класса:
- clear() - очистка корзины.
- сеттеры для показа  темплейта списка карточек и общей стоимости корзины.

#### Класс OrderForm
Класс реализует форму для получения данных из полей ввода. При нажатии на кнопку инициирует событие, передавая в него объект с данными из полей ввода формы.\
При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления доступностью кнопки.

Поля класса:
- submitButton: HTMLButtonElement - кнопка для сабмита и перехода к следующему окну и сохранения данных
- errorSpan: Record<string, HTMLElement> - поле для отображения ошибок валидации

Методы:
- сеттер valid(value: boolean): void - управляет активностью кнопки
- сеттер error(value: string): void - отображает текст ошибки
- render - расширенный метод рендера


#### Класс OrderPayment
Класс реализует форму с данными об оплате и адресом.\
При изменении данных в полях ввода инициирует событие. Предоставляет методы для сохранения значений поля ввода и выбраной кнопки.

Полем класса является список элементов из кнопок для выбора способа оплаты.

#### Класс OrderContacts
Класс реализует форму с данными о почте и теоефоне.\
При изменении данных в полях ввода инициирует событие. Предоставляет методы для сохранения значений поля почты и телефон.

#### Класс OrderSuccess
Класс реализует окно-результат уведомления об успешном действии. При нажатии на кнопку инициирует событие о закрытии. 

Поля класса:
- totalPayed: HTMLParagraphElement - элемент разметки, отображающий финальную сумму заказа
- closeButton: HTMLElement - элемент кнопки для возвращения к каталогу 

Методы класса:
- сеттер для установки стоимости заказа из корзины
- getContainer(): HTMLElement - передает информацию о контейнере

### Классы коммуникации

#### Класс LarekApi
Принимает в конструктор экземпляр класса Api и предоставляет методы, реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой, находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий, генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

### *Список всех событий, коорые могут генерироваться в системе:*
*События изменения данных (генерируются моделями данных)*
- `items:changed` - изменение списка товаров
- `basket:added` - в корзину добавлена карточка
- `basket:deleted` - из корзины удалена карточка
- `basket:cleared` - корзина очищена
- `order:changed` - изменения данных заказа

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируется классами, отвечающими за представление)*
- `card-preview:open` - открытие модального окна с предпросмотром карточки товара

- `form:change` - изменены данные в инпуте
- `basket:set` - данные в корзине отображены
- `orderForm:open` - открытие модального окна с заполнением данных о заказе
- `modal:open` - открыто модальное окно
- `modal:close` - закрытие модального окна
- `basket:open` - событие перехода на следующий этап оформления заказа из корзины и сохранение данных
- `catalog:set` - карточки в галерее загружены
- `card:select` - выбрана карточка для отображения в превью
- `cardToBasket:added`  - продукт добавлен в корзину
- `basketProduct:deleted` - продукт удален из корзины
